<% pageTitle="e-Apostille application" %>

    <div class="inner_header <%if (!user_data.loggedIn){%>no-user-signed-in<%}%>">
        <a href="/dashboard" class="back-to-previous govuk-link">Back</a>
        <%- partial ('../partials/inner-header.ejs')%>
    </div>

    <% if (applicationStatus === 'Completed' && !applicationExpired) { %>
        <div class="column-two-thirds">
            <div class="govuk-notification-banner" role="region" aria-labelledby="govuk-notification-banner-title"
                data-module="govuk-notification-banner">
                <div class="govuk-notification-banner__header">
                    <h2 class="govuk-notification-banner__title" id="govuk-notification-banner-title">
                        Important
                    </h2>
                </div>
                <div class="govuk-notification-banner__content">
                    <p class="govuk-notification-banner__heading">
                        <% if (daysLeftToDownload===0) {%>
                            You have until midnight
                        <%} else {%>
                            You have <%= daysLeftToDownload %> <% if (daysLeftToDownload===1) { %>day<%} else {%>days<% } %> left
                        <% } %>
                        to download the legalised documents.
                    </p>
                </div>
            </div>
        </div>
    <% } %>

    <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
            <span class="caption-xlarge">e-Apostille application</span>
            <h1 class="heading-xlarge govuk-!-margin-top-2">
                <%= applicationId %>
            </h1>
        </div>
    </div>

    <section class="column-two-thirds">
        <% if (applicationStatus === 'Completed') { %>
            <% if (applicationExpired) { %>
                <p>
                    The 21 day window to download the legalised documents has now expired to protect privacy.
                </p>
                <p>
                    If you did not download the PDFs, you will need to start a new application and re-upload the PDFs if you wish to
                    have
                    them legalised again. You will have to pay for each uploaded PDF.
                </p>
            <% } else { %>
                <p>
                    You can now download PDF versions of the legalised documents.
                </p>
                <div class="govuk-warning-text">
                    <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
                    <strong class="govuk-warning-text__text">
                        <span class="govuk-warning-text__assistive">Warning</span>
                        If you do not download your legalised documents within 21 days (by midnight on the last day), they will be deleted for
                        data privacy reasons. You will need to pay for another application to have the documents legalised again.
                    </strong>
                </div>
                <h2 class="heading-medium">Download documents</h2>
                <p>
                    You can download each PDF as many times as you wish before it is deleted.
                </p>
                <p>
                    Once downloaded, you can send the entire PDF to the overseas authority that needs the legalised documents.
                    Each PDF contains a copy of the original uploaded PDF along with an e-Apostille.
                </p>
                <p>
                    You cannot use a printed version of the PDF, as the PDF contains the FCDO digital signature which ensures
                    its authenticity and prevents tampering.
                </p>
            <% } %>
        <% } else { %>
            <p>
                Your application has been successfully submitted.
            </p>
            <p>
                We will notify you by email when it has been legalised. Your successfully legalised document will then be
                available for download from this page.
            </p>
            <p>
                You will have 21 days from when the documents have been successfully legalised to download them before they
                are deleted for security reasons.
            </p>
        <% } %>

        <table class="govuk-table">
            <caption class="heading-medium">PDF files</caption>
            <tbody class="govuk-table__body">
                <% for (const document of documents) {%>
                    <%- partial ('../partials/documentRow.ejs', {document, applicationStatus, applicationId, applicationExpired})%>
                <% } %>
            </tbody>
        </table>

        <h2 class="heading-medium">Application details</h2>
        <dl class="govuk-summary-list govuk-summary-list--no-border">
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key govuk-summary-list__key--wide">
                    Service
                </dt>
                <dd class="govuk-summary-list__value">
                    e-Apostille
                </dd>
            </div>
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key govuk-summary-list__key--wide">
                    Date submitted
                </dt>
                <dd class="govuk-summary-list__value">
                    <%= dateSubmitted %>
                </dd>
            </div>
            <% if (userRef) { %>
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key govuk-summary-list__key--wide">
                        Your reference
                    </dt>
                    <dd class="govuk-summary-list__value">
                        <%= userRef %>
                    </dd>
                </div>
            <% } %>
        </dl>

        <h2 class="heading-medium">Payment details</h2>
        <dl class="govuk-summary-list govuk-summary-list--no-border">
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key govuk-summary-list__key--wide">
                    Original cost
                </dt>
                <dd class="govuk-summary-list__value">
                    <%= originalCost %>
                </dd>
            </div>
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key govuk-summary-list__key--wide">
                    Payment reference
                </dt>
                <dd class="govuk-summary-list__value">
                    <%= paymentRef %>
                </dd>
            </div>
        </dl>

        <p>Your payment will appear on your bank statement as FCDO Legalisation Service.</p>

        <a href="/download-receipt/<%= applicationId %>" class="govuk-link govuk-!-margin-top-2" role="button" download="<%= applicationId %>.pdf">Download your receipt</a>
    </section>
